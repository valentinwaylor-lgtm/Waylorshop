<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Waylorshop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #111827;
            color: white;
            -webkit-tap-highlight-color: transparent;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Простая версия приложения на чистом JavaScript
        const state = {
            currentPage: 'home',
            cart: [],
            favorites: [],
            selectedProduct: null,
            selectedSize: 'S'
        };

        const products = [
            { id: 1, name: 'Куртка "Спец 2" серая', price: 6200, image: 'https://via.placeholder.com/300/6B7280/FFF?text=Серая', sizes: ['S','M','L','XL'] },
            { id: 2, name: 'Куртка "Спец 2" черная', price: 6200, image: 'https://via.placeholder.com/300/1F2937/FFF?text=Черная', sizes: ['S','M','L','XL'] },
            { id: 3, name: 'Штаны "Спец 2" серые', price: 5400, image: 'https://via.placeholder.com/300/6B7280/FFF?text=Штаны+С', sizes: ['S','M','L','XL'] },
            { id: 4, name: 'Штаны "Спец 2" черные', price: 5400, image: 'https://via.placeholder.com/300/1F2937/FFF?text=Штаны+Ч', sizes: ['S','M','L','XL'] }
        ];

        // Инициализация Telegram
        if (window.Telegram?.WebApp) {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
        }

        function render() {
            const root = document.getElementById('root');
            
            if (state.currentPage === 'home') {
                root.innerHTML = `
                    <div class="min-h-screen bg-gray-900 pb-20">
                        <header class="bg-black p-4 sticky top-0 z-10">
                            <h1 class="text-xl font-bold text-center text-white">Waylorshop</h1>
                        </header>
                        <div class="p-4 grid grid-cols-2 gap-4">
                            ${products.map(p => `
                                <div class="bg-white rounded-lg overflow-hidden">
                                    <div class="relative">
                                        <img src="${p.image}" class="w-full h-48 object-cover">
                                        <button onclick="toggleFavorite(${p.id})" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow">
                                            <svg class="w-5 h-5 ${state.favorites.includes(p.id) ? 'fill-red-500 stroke-red-500' : 'stroke-gray-400'}" fill="${state.favorites.includes(p.id) ? 'currentColor' : 'none'}" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="p-3">
                                        <p class="text-xl font-bold text-gray-900">${p.price.toLocaleString()} ₽</p>
                                        <p class="text-sm text-gray-700 mt-1">${p.name}</p>
                                        <button onclick="openProduct(${p.id})" class="mt-3 w-full bg-blue-500 text-white py-2 rounded-lg text-sm font-medium">
                                            Подробнее
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${bottomNav()}
                    </div>
                `;
            } else if (state.currentPage === 'product') {
                const p = state.selectedProduct;
                root.innerHTML = `
                    <div class="min-h-screen bg-gray-900 pb-20">
                        <header class="bg-black p-4 sticky top-0 z-10 flex items-center">
                            <button onclick="goHome()" class="text-white">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <h1 class="flex-1 text-lg font-bold text-center text-white">Waylorshop</h1>
                            <div class="w-6"></div>
                        </header>
                        <img src="${p.image}" class="w-full h-96 object-cover bg-white">
                        <div class="p-4">
                            <div class="mb-4">
                                <p class="text-gray-400 text-sm mb-2">Размер: ${state.selectedSize}</p>
                                <div class="flex gap-2">
                                    ${p.sizes.map(s => `
                                        <button onclick="setSize('${s}')" class="px-6 py-3 rounded-lg font-medium ${state.selectedSize === s ? 'bg-blue-500 border-2 border-blue-400' : 'bg-gray-800 border-2 border-gray-700'}">
                                            ${s}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                            <h2 class="text-xl font-bold mb-2">${p.name}</h2>
                            <p class="text-2xl font-bold mb-4">${p.price.toLocaleString()} ₽</p>
                            <button onclick="addToCart()" class="w-full bg-blue-500 text-white py-4 rounded-lg font-bold text-lg">
                                Добавить в корзину
                            </button>
                        </div>
                    </div>
                `;
            } else if (state.currentPage === 'cart') {
                const total = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                root.innerHTML = `
                    <div class="min-h-screen bg-gray-900 pb-20">
                        <header class="bg-black p-4 sticky top-0 z-10 flex items-center">
                            <button onclick="goHome()" class="text-white">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <h1 class="flex-1 text-lg font-bold text-center text-white">Корзина</h1>
                            ${state.cart.length > 0 ? '<button onclick="clearCart()" class="text-blue-400 text-sm">Очистить</button>' : '<div class="w-20"></div>'}
                        </header>
                        <div class="p-4">
                            ${state.cart.length === 0 ? `
                                <div class="text-center py-20">
                                    <p class="text-gray-400 text-lg mb-4">Корзина пуста</p>
                                    <button onclick="goHome()" class="bg-blue-500 text-white px-6 py-3 rounded-lg">Вернуться</button>
                                </div>
                            ` : `
                                ${state.cart.map((item, i) => `
                                    <div class="bg-gray-800 rounded-lg p-4 mb-4 flex gap-4">
                                        <img src="${item.image}" class="w-20 h-20 rounded-lg object-cover">
                                        <div class="flex-1">
                                            <h3 class="font-bold">${item.name}</h3>
                                            <p class="text-sm text-gray-400">Размер ${item.size}</p>
                                            <div class="flex items-center gap-4 mt-2">
                                                <div class="flex items-center gap-3 bg-black rounded-full px-4 py-2">
                                                    <button onclick="updateQuantity(${i}, -1)" class="text-xl font-bold">−</button>
                                                    <span class="font-bold">${item.quantity}</span>
                                                    <button onclick="updateQuantity(${i}, 1)" class="text-xl font-bold">+</button>
                                                </div>
                                                <span class="font-bold">${(item.price * item.quantity).toLocaleString()} ₽</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                                <div class="mt-6 p-4 bg-gray-800 rounded-lg">
                                    <div class="flex justify-between text-xl font-bold">
                                        <span>Итого</span>
                                        <span>${total.toLocaleString()} ₽</span>
                                    </div>
                                </div>
                                <button onclick="checkout()" class="w-full bg-blue-500 text-white py-4 rounded-lg font-bold text-lg mt-6">
                                    Оформить заказ · ${total.toLocaleString()} ₽
                                </button>
                            `}
                        </div>
                        ${bottomNav()}
                    </div>
                `;
            }
        }

        function bottomNav() {
            const cartCount = state.cart.length;
            return `
                <nav class="fixed bottom-0 left-0 right-0 bg-black border-t border-gray-800 flex justify-around py-3 z-50">
                    <button onclick="goHome()" class="flex flex-col items-center gap-1">
                        <svg class="w-6 h-6 ${state.currentPage === 'home' ? 'text-blue-400' : 'text-gray-400'}" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span class="text-xs ${state.currentPage === 'home' ? 'text-blue-400' : 'text-gray-400'}">Главная</span>
                    </button>
                    <button onclick="goToCart()" class="flex flex-col items-center gap-1 relative">
                        <svg class="w-6 h-6 ${state.currentPage === 'cart' ? 'text-blue-400' : 'text-gray-400'}" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        ${cartCount > 0 ? `<span class="absolute -top-1 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">${cartCount}</span>` : ''}
                        <span class="text-xs ${state.currentPage === 'cart' ? 'text-blue-400' : 'text-gray-400'}">Корзина</span>
                    </button>
                </nav>
            `;
        }

        function goHome() { state.currentPage = 'home'; render(); }
        function goToCart() { state.currentPage = 'cart'; render(); }
        function openProduct(id) {
            state.selectedProduct = products.find(p => p.id === id);
            state.selectedSize = 'S';
            state.currentPage = 'product';
            render();
        }
        function setSize(size) { state.selectedSize = size; render(); }
        function toggleFavorite(id) {
            const idx = state.favorites.indexOf(id);
            if (idx >= 0) state.favorites.splice(idx, 1);
            else state.favorites.push(id);
            render();
        }
        function addToCart() {
            const existing = state.cart.find(i => i.id === state.selectedProduct.id && i.size === state.selectedSize);
            if (existing) existing.quantity++;
            else state.cart.push({...state.selectedProduct, size: state.selectedSize, quantity: 1});
            state.currentPage = 'cart';
            render();
        }
        function updateQuantity(index, change) {
            state.cart[index].quantity += change;
            if (state.cart[index].quantity <= 0) state.cart.splice(index, 1);
            render();
        }
        function clearCart() { state.cart = []; render(); }
        function checkout() {
            const orderData = { items: state.cart, total: state.cart.reduce((s, i) => s + i.price * i.quantity, 0) };
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify(orderData));
            } else {
                alert('Заказ оформлен!\nСумма: ' + orderData.total.toLocaleString() + ' ₽');
            }
        }

        // Запуск
        render();
    </script>
</body>
</html>
